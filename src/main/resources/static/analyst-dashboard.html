<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>分析師中心 - StockMatch</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <script defer src="js/analyst-dashboard.js"></script>
</head>
<body class="bg-gray-50 text-gray-800 overflow-y-scroll">
  <!-- 導覽列 -->
  <header class="bg-white" x-data="{ open: false }">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <a href="index.html" class="text-2xl font-bold text-blue-700">StockMatch</a>
      <nav class="hidden md:flex space-x-4">
        <a href="index.html" class="text-gray-700 hover:text-blue-600">首頁</span>
        <a href="about.html" class="text-gray-700 hover:text-blue-600">關於我們</a>
        <a href="analyst-list.html" class="text-gray-700 hover:text-blue-600">找分析師</a>
        <a href="#" class="text-gray-700 hover:text-blue-600">免費試閱</a>
        <a href="simulator.html" class="text-gray-700 hover:text-blue-600">模擬交易</a>
        <a href="#" class="text-gray-700 hover:text-blue-600">購物車</a>
        <span class="text-blue-700 font-semibold">分析師中心</span>
      </nav>
      <button @click="open = !open" class="md:hidden text-gray-600">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
    <!-- 手機選單 -->
    <div x-show="open" class="md:hidden px-4 pb-4 space-y-2">
      <a href="index.html" class="block text-gray-700 hover:text-blue-600">首頁</span>
      <a href="about.html" class="block text-gray-700 hover:text-blue-600">關於我們</a>
      <a href="analyst-list.html" class="block text-gray-700 hover:text-blue-600">找分析師</a>
      <a href="#" class="block text-gray-700 hover:text-blue-600">免費試閱</a>
      <a href="#" class="block text-gray-700 hover:text-blue-600">模擬交易</a>
      <a href="#" class="block text-gray-700 hover:text-blue-600">購物車</a>
      <span class="block text-blue-700 font-semibold">分析師中心</span>
    </div>
  </header>

  <!-- 主區塊 -->
  <main class="max-w-6xl mx-auto py-10 px-4" x-data="{ tab: 'plans' }">
    <template x-effect="if (tab === 'plans') $nextTick(() => loadMyPlans(analystId))"></template>
    <template x-effect="if (tab === 'viewReports') $nextTick(() => loadReports(analystId))"></template>
    <template x-effect="if (tab === 'reports') $nextTick(() => populatePlanOptions(analystId))"></template>
    <template x-effect="if (tab === 'info') $nextTick(() => loadAnalystInfo())"></template>
    <template x-effect="if (tab === 'account') $nextTick(() => loadAnalystProfile())"></template>


    <h2 class="text-3xl font-bold text-center mb-6">🏠 分析師中心</h2>

    <!-- 頁籤 -->
    <div class="flex justify-center space-x-4 mb-8">
      <button @click="tab = 'plans'" :class="tab === 'plans' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600 hover:text-blue-500'" class="px-4 py-2 font-semibold">我的方案</button>
      <button @click="tab = 'create'" :class="tab === 'create' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600 hover:text-blue-500'" class="px-4 py-2 font-semibold">新增方案</button>
      <button @click="tab = 'viewReports'" :class="tab === 'viewReports' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600 hover:text-blue-500'" class="px-4 py-2 font-semibold">查看報告</button>
      <button @click="tab = 'reports'" :class="tab === 'reports' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600 hover:text-blue-500'" class="px-4 py-2 font-semibold">發布報告</button>
      <button @click="tab = 'info'" :class="tab === 'info' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600 hover:text-blue-500'" class="px-4 py-2 font-semibold">分析師資料</button>
      <button @click="tab = 'account'" :class="tab === 'account' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600 hover:text-blue-500'" class="px-4 py-2 font-semibold">帳號設定</button>
      <button @click="tab = 'logout'" :class="tab === 'logout' ? 'border-b-2 border-red-500 text-red-600' : 'text-gray-600 hover:text-red-500'" class="px-4 py-2 font-semibold">登出</button>
    </div>

    
    <!-- 我的方案 -->
    <div x-show="tab === 'plans'" class="bg-white p-6 rounded shadow">
      <h3 class="text-xl font-semibold mb-4 text-blue-700">📦 我的方案</h3>
      <div id="myPlans" class="space-y-4">載入中...</div>
    </div>
    
    <!-- 新增方案 -->
    <div x-show="tab === 'create'" class="bg-white p-6 rounded shadow">
      <h3 class="text-xl font-semibold mb-4 text-blue-700">➕ 新增方案</h3>
      <form id="createPlanForm" class="space-y-4">
        <input type="hidden" id="analystId" />
        <div>
          <label class="block text-gray-700 font-semibold">方案名稱</label>
          <input type="text" id="planName" placeholder="例如：三週 VIP 教學" class="w-full border px-3 py-2 rounded" required />
        </div>
        <div>
          <label class="block text-gray-700 font-semibold">方案說明</label>
          <textarea id="planDescription" placeholder="請輸入方案內容..." class="w-full border px-3 py-2 rounded" rows="3"></textarea>
        </div>
        <div>
          <label class="block text-gray-700 font-semibold">價格（NT$）</label>
          <input type="number" id="planPrice" placeholder="價格（NT$）" class="w-full border px-3 py-2 rounded" required />
        </div>
        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">新增方案</button>
      </form>
    </div>

    <!-- 查看報告 -->
    <div x-show="tab === 'viewReports'" class="bg-white p-6 rounded shadow space-y-4">
      <h3 class="text-xl font-semibold mb-4 text-blue-700">📄 查看報告</h3>
      <div id="reportList" class="space-y-4">載入中...</div>
    </div>

    <!-- 發布報告 -->
    <div x-show="tab === 'reports'" class="bg-white p-6 rounded shadow">
      <h3 class="text-xl font-semibold mb-4 text-blue-700">📝 投資報告</h3>
      <form id="reportForm" class="space-y-4">
        <input type="text" id="reportTitle" placeholder="報告標題" class="w-full border px-3 py-2 rounded" required />
        <textarea id="reportContent" placeholder="報告內容" class="w-full border px-3 py-2 rounded" rows="4"></textarea>
        <select id="reportPlan" class="w-full border px-3 py-2 rounded" required>
          <option value="">選擇要發布的方案</option>
        </select>
        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">發布報告</button>
      </form>
    </div>

    <!-- 分析師資料 -->
    <div x-show="tab === 'info'" class="p-4 bg-white rounded shadow">
      <h3 class="text-xl font-semibold text-blue-700 mb-4">📋 分析師資料</h3>
      <div id="analystInfoBox" class="text-gray-700 space-y-3"></div>
    </div>


    <!-- 帳號設定 -->
    <div x-show="tab === 'account'" class="bg-white p-6 rounded shadow space-y-4">
      <h3 class="text-xl font-semibold mb-4 text-blue-700">⚙️ 帳號設定</h3>
      <form id="profileForm" class="space-y-4">
        <!-- 密碼欄位 -->
        <div>
          <label class="block font-medium mb-1">新密碼（選填）</label>
          <input type="password" id="newPassword" class="w-full border px-3 py-2 rounded" placeholder="留空則不修改密碼" />
        </div>

        <!-- 職稱 -->
        <div>
          <label class="block font-medium mb-1">職稱</label>
          <input type="text" id="title" class="w-full border px-3 py-2 rounded" placeholder="留空則不修改職稱）" />
        </div>

        <!-- 個人簡介 -->
        <div>
          <label class="block font-medium mb-1">個人簡介</label>
          <textarea id="bio" class="w-full border px-3 py-2 rounded" rows="3" placeholder="留空則不修改簡介"></textarea>
        </div>

        <!-- 專長多選（由 JS 動態產生） -->
        <div>
          <label class="block font-medium mb-1">專長領域：</label>
          <div id="specialtyCheckboxGroup" class="grid grid-cols-2 gap-2">
            <!-- 專長勾選由 JS 動態插入 -->
          </div>
        </div>
        
        <!-- 個人頭像 -->
        <div>
          <label class="block font-medium mb-1">個人頭像</label>
          <input type="file" id="profileImg" accept="image/*" class="w-full" />
          <img id="profilePreview" src="" alt="頭像預覽" class="mt-2 w-32 h-32 object-cover rounded-full border" />
        </div>

        <!-- 證照圖片 -->
        <div>
          <label class="block font-medium mb-1">證照圖片</label>
          <input type="file" id="certificateImg" accept="image/*" class="w-full" />
          <img id="certificatePreview" src="" alt="證照預覽" class="mt-2 w-32 h-32 object-cover rounded-full border" />
        </div>


        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">更新帳號</button>
      </form>
    </div>


    <!-- 登出 -->
    <div x-show="tab === 'logout'" class="text-center bg-white p-6 rounded shadow">
      <h2 class="text-xl font-semibold text-red-600 mb-2">⚠️ 登出提醒</h2>
      <p>您確定要登出嗎？</p>
      <div class="mt-3">
        <button onclick="logout()" class="bg-red-500 text-white px-6 py-2 rounded hover:bg-red-600">確認登出</button>
      </div>   
    </div>
  </main>

  <footer class="bg-blue-50 py-6 mt-12">
    <div class="max-w-6xl mx-auto px-4 text-center">
      &copy; 2025 StockMatch 投資媒合平台
    </div>
  </footer>

  <!-- Toast 成功提示 -->
  <div id="toast" class="fixed top-5 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-4 py-2 rounded shadow-lg hidden z-50"></div>

  <!-- 錯誤提示區塊 -->
  <div id="error-message" class="fixed top-5 left-1/2 transform -translate-x-1/2 bg-red-500 text-white px-4 py-2 rounded shadow-lg hidden z-50"></div>


  <script>
    function logout() {
      localStorage.removeItem("user");
      window.location.href = "index.html";
    }
  </script>

</body>
</html>
